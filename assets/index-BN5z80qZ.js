import{c as I,d as E,j as s,u as Z,f as G,p as J,s as Q,h as ee,R as te,L as ne,S as se,q as re}from"./index-DgDS95zu.js";import{A as ae}from"./index-BtGq94Vz.js";import{B as ie}from"./index-CUjWgdxJ.js";import{F as V,C as oe}from"./index-B0kuquvW.js";/* empty css              */import{I as ue}from"./index-DWF4fKbI.js";import{u as U}from"./useMutation-BVHFNGNj.js";import{u as _}from"./api-Df7WHB2j.js";import{s as O}from"./index-ojMjYGyW.js";/* empty css              */import"./row-SZHG0-a2.js";import"./responsiveObserver-DRpm5Nti.js";import"./index-DwhGeG0W.js";import"./index-R0fvpz9K.js";import"./TextArea-DPz20TLR.js";var M=function(n){return typeof n=="object"&&n!==null},ce=function(n){var i=n.value,d=i===void 0?"":i,u=n.numInputs,r=u===void 0?4:u,m=n.onChange,y=n.onPaste,c=n.renderInput,h=n.shouldAutoFocus,A=h===void 0?!1:h,b=n.inputType,w=b===void 0?"text":b,N=n.renderSeparator,v=n.placeholder,l=n.containerStyle,S=n.inputStyle,f=n.skipDefaultStyles,T=f===void 0?!1:f,B=I.useState(0),p=B[0],R=B[1],j=I.useRef([]),D=function(){return d?d.toString().split(""):[]},k=w==="number"||w==="tel";I.useEffect(function(){j.current=j.current.slice(0,r)},[r]),I.useEffect(function(){var e;A&&((e=j.current[0])===null||e===void 0||e.focus())},[A]);var q=function(){if(typeof v=="string"){if(v.length===r)return v;v.length>0&&console.error("Length of the placeholder should be equal to the number of inputs.")}},C=function(e){var t=k?!isNaN(Number(e)):typeof e=="string";return t&&e.trim().length===1},z=function(e){var t=e.target.value;C(t)&&(F(t),x(p+1))},K=function(e){var t=e.nativeEvent,a=e.target.value;if(!C(a)){if(a.length===r){var o=a.split("").some(function(g){return!C(g)});o||(L(a.split("")),x(r-1))}t.data===null&&t.inputType==="deleteContentBackward"&&(e.preventDefault(),F(""),x(p-1)),e.target.value=""}},$=function(e){return function(t){R(t),e.target.select()}},H=function(){R(p-1)},W=function(e){var t=D();[e.code,e.key].includes("Backspace")?(e.preventDefault(),F(""),x(p-1)):e.code==="Delete"?(e.preventDefault(),F("")):e.code==="ArrowLeft"?(e.preventDefault(),x(p-1)):e.code==="ArrowRight"||e.key===t[p]?(e.preventDefault(),x(p+1)):(e.code==="Spacebar"||e.code==="Space"||e.code==="ArrowUp"||e.code==="ArrowDown")&&e.preventDefault()},x=function(e){var t,a,o=Math.max(Math.min(r-1,e),0);j.current[o]&&((t=j.current[o])===null||t===void 0||t.focus(),(a=j.current[o])===null||a===void 0||a.select(),R(o))},F=function(e){var t=D();t[p]=e[0],L(t)},L=function(e){var t=e.join("");m(t)},X=function(e){var t;e.preventDefault();var a=D(),o=p,g=e.clipboardData.getData("text/plain").slice(0,r-p).split("");if(!(k&&g.some(function(Y){return isNaN(Number(Y))}))){for(var P=0;P<r;++P)P>=p&&g.length>0&&(a[P]=(t=g.shift())!==null&&t!==void 0?t:"",o++);x(o),L(a)}};return I.createElement("div",{style:Object.assign({display:"flex",alignItems:"center"},M(l)&&l),className:typeof l=="string"?l:void 0,onPaste:y},Array.from({length:r},function(e,t){return t}).map(function(e){var t,a,o;return I.createElement(I.Fragment,{key:e},c({value:(t=D()[e])!==null&&t!==void 0?t:"",placeholder:(o=(a=q())===null||a===void 0?void 0:a[e])!==null&&o!==void 0?o:void 0,ref:function(g){return j.current[e]=g},onChange:z,onFocus:function(g){return $(g)(e)},onBlur:H,onKeyDown:W,onPaste:X,autoComplete:"off","aria-label":"Please enter OTP character ".concat(e+1),style:Object.assign(T?{}:{width:"1em",textAlign:"center"},M(S)?S:{}),className:typeof S=="string"?S:void 0,type:w,inputMode:k?"numeric":"text",onInput:K},e),e<r-1&&(typeof N=="function"?N(e):N))}))};function le({count:n=6}){const[i,d]=E.useState(""),u=V.useFormInstance();return E.useEffect(()=>{u.setFieldsValue({otp:i}),i.length===n&&u.submit()},[i,u,n]),s.jsx(V.Item,{name:"otp",className:"w-full",rules:[{required:!0,message:"Please enter the OTP"},{len:n,message:`OTP must be ${n} digits`}],children:s.jsx("div",{className:"validate-code-container",children:s.jsx(ce,{value:i,shouldAutoFocus:!0,onChange:r=>{/[a-zA-Z0-9]+$/.test(r)&&d(r)},numInputs:n,renderInput:({style:r,...m})=>s.jsx(ue,{...m,className:"otp-input-field",placeholder:"X"})})})})}const fe=()=>{const n=async c=>(await _.post("/userservice/v1/verify-user-email/",c,{headers:{"Content-Type":"application/json"}})).data,{mutate:i,data:d,error:u,isLoading:r,isError:m,isSuccess:y}=U(n);return{mutate:i,data:d,error:u,isLoading:r,isError:m,isSuccess:y}},pe=()=>{const n=async c=>(await _.post("/userservice/v1/resend-verification-code/",c,{headers:{"Content-Type":"application/json"}})).data,{mutate:i,data:d,error:u,isLoading:r,isError:m,isSuccess:y}=U(n);return{mutate:i,data:d,error:u,isLoading:r,isError:m,isSuccess:y}},Te=()=>{const n=Z(),i=G(),{email:d}=J(f=>f.auth),{mutate:u,isLoading:r,isError:m,isSuccess:y,data:c,error:h}=fe(),{mutate:A,isLoading:b,isError:w,isSuccess:N,error:v,data:l}=pe();E.useEffect(()=>{w&&(v!=null&&v.message)&&O.error(v==null?void 0:v.message)},[w]),E.useEffect(()=>{l!=null&&l.message&&O.success(l==null?void 0:l.message)},[N,l]),E.useEffect(()=>{var f,T;m&&((T=(f=h==null?void 0:h.response)==null?void 0:f.data)!=null&&T.error)&&O.error(h.response.data.error)},[m]),E.useEffect(()=>{var f;(f=c==null?void 0:c.response)!=null&&f.token&&(i(Q(c.response.token)),i(ee(c.response.user)),n(te.EMAIL_VERIFIED))},[y,c]);const S=f=>{u({code:f.otp,email:d})};return s.jsxs("div",{className:"flex items-center justify-center w-full h-[100vh] text-center",children:[s.jsxs("div",{className:"content w-[100vw] md:w-[50vw] lg:w-[40vw] p-2 text-white flex items-center flex-col",children:[s.jsx(ae,{}),s.jsx("span",{className:"text-4xl md:text-4xl lg:text-5xl text-secondary px-[10%] mb-5",children:s.jsx("span",{className:"whitespace-nowrap",children:"VERIFY EMAIL"})}),s.jsx("span",{className:"text-primary text-md lg:text-lg p-2 m-2 mb-5 px-[10%]",children:"We have sent you an email confirmation. Please check your mail and enter the code we sent you to enjoy Idea Space."}),s.jsxs("div",{className:"w-full px-[10%]",children:[s.jsxs(V,{onFinish:S,children:[s.jsx(le,{}),s.jsx(oe,{text:"AUTHENTICATE",isLoading:r})]}),s.jsx("div",{className:"text-white text-sm  my-1 text-primary flex flex-col gap-1",children:b?s.jsxs("div",{children:[s.jsx(se,{indicator:s.jsx(re,{spin:!0}),className:"text-white mr-2",size:"small"}),s.jsx("div",{className:"font-bold text-white",children:"Sending verification link..."})]}):s.jsxs("div",{children:["Didn't get email?Â ",s.jsx(ne,{to:"#",className:"font-bold underline",onClick:()=>A({email:d}),children:"Resend authentication link"})]})})]})]}),s.jsx(ie,{})]})};export{Te as default};
